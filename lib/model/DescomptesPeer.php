<?php

require 'lib/model/om/BaseDescomptesPeer.php';


/**
 * Skeleton subclass for performing query and update operations on the 'descomptes' table.
 *
 * 
 *
 * This class was autogenerated by Propel 1.4.2 on:
 *
 * 01/30/12 12:18:36
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    lib.model
 */
class DescomptesPeer extends BaseDescomptesPeer {

    const CAP = 0;

	static public function initialize( $idD , $idS )
	{
		$OD = self::retrieveByPK($idD);
        
        if(!($OD instanceof Descomptes))
        {                    		            			
    		$OD = new Descomptes();        
            $OD->setSiteId($idS);                    
            $OD->setActiu(true);
        }
        
        return new DescomptesForm($OD,array('IDS'=>$idS));
	}
    

    /**
     * @param $new ( Apareix al desplegble que se'n pot afegir un )
     * */
    static public function getDescomptesArray($idS,$new,$config = false){
        
        $C = new Criteria();
        $C->add(self::SITE_ID, $idS);
        $C->add(self::ACTIU, true);
        
        $RET = array();
        if($new) $RET[null] = "Nou descompte";
        if(!$config) $RET[0] = 'Cap descompte';
        foreach(self::doSelect($C) as $OD):
            $RET[$OD->getIddescompte()] = $OD->getNom().' ('.$OD->getPercentatgeTxt().')';
        endforeach;
                
        return $RET;
    }

    static public function getPreuAmbDescompte($valor,$idD){
        
        //Si no hi ha descompte, tornem el valor. 
        if(is_null($idD))
        { 
            return $valor;
             
        //Si hi ha descompte, el busquem. Si no el trobem, no l'apliquem.
        } else {
            
            $OD = DescomptesPeer::retrieveByPK($idD);                
            if(!($OD instanceof Descomptes)) return $valor;
            
            $P = $OD->getPercentatge();
            
            return $valor - round((int)$valor*(float)$P/(int)100);
                        
        }
                       
    }


} // DescomptesPeer
